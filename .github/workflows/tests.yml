name: 'tree-garden types and test'

on:
  push:
    branches:
      - 'master'

env:
  node_image: node:16-alpine3.16
  runner_type: ubuntu-latest

jobs:
  install_deps:
    runs-on: ${{ env.runner_type }}
    container:
      image: ${{ env.node_image }}

    steps:
      - name: 'Checkout code - as we need package.json + lock'
        uses: actions/checkout@v3

      - name: 'Cache based on package.lock.json '
        id:  'node_modules_cache'
        uses: actions/cache@v3
        with:
          path: ./node_modules
          key: node_modules_cache_${{ hashFiles('package-lock.json') }}

      -  if: ${{ steps.node_modules_cache.outputs.cache-hit != 'true' }}
         name: 'Install node dependencies if no cache hit'
         run: npm ci


  unit-tests:

    runs-on: ${{ env.runner_type }}
    container:
      image: ${{ env.node_image }}
    needs: [install_deps]

    steps:
      - name: 'Checkout code'
        uses: actions/checkout@v3

      - name: 'Cache based on package.lock.json '
        id: 'node_modules_cache'
        uses: actions/cache@v3
        with:
          path: ./node_modules
          key: node_modules_cache_${{ hashFiles('package-lock.json') }}


      - name: 'Run unit tests'
        run: npm run test

